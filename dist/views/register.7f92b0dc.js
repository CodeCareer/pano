!function(){"use strict";angular.module("kt.pano").controller("ktRegisterCtrl",["$rootScope","$scope","$timeout","$window","$state","CacheFactory","ktLoginService","ktRegisterService","ktSweetAlert","ktGetCaptcha",function(a,b,c,d,e,f,g,h,i,j){a.goHome=function(){e.go("home.index")},b.QRCodeVisible=!1,b.registerUser={agreement:1},b.submitForm=function(){return b.pendingRequests=!0,b.registerUser.password_confirmation=b.registerUser.password,h.save(b.registerUser).$promise.then(function(){b.user={mobile:b.registerUser.mobile,password:b.registerUser.password},g.save(b.user,function(a){b.pendingRequests=!1,a.token&&(f.clearAll(),d.localStorage.token=a.token,i.swal({title:"注册成功！",text:"",type:"success"},function(){e.go("account.perfect")}))})},function(a){b.pendingRequests=!1,i.swal({title:"提交失败",text:$.isArray(a.error)?a.error.join("<br/>"):a.error||"抱歉，您的信息没有提交成功，请再次尝试！",type:"error"})}),!1},b.captchaSettings={randomColours:!1,colour1:"#eef7fb",colour2:"#4a6920"};var k=j.getCaptcha(b,h,{content:"captcha"},b.registerUser);b.getCaptcha=function(a,d){a.preventDefault(),a.stopPropagation();var e=b.captchaSettings.CAPTCHA;return e?void e.validate(b.registerUser.img_captcha,function(a){if(a){if("sms"===d&&b.waitCaptchaMessage)return;if("tel"===d&&b.waitCaptchaTel)return;k(b.registerUser.mobile,d)}else c(function(){i.swal({title:"提示",text:"图形验证码不正确！",type:"error"},function(){var a=e._container.closest("form");a.trigger("accessible."+a.attr("id"),{field:"img_captcha"}),b.registerUser.img_captcha=""})},100)}):void i.swal({title:"验证码组件有误",text:"验证码组件有误！",type:"error"})}}])}();