!function(){"use strict";angular.module("kt.pano").controller("ktSettingsCtrl",["$rootScope","$timeout","$scope","$state","$location","$uibModal","$window","ktSweetAlert","ktAccountService","ktCardsService",function(a,b,c,d,e,f,g,h,i,j){c.visibleJudgement=function(b){return _.includes(b||[],a.user?a.user.status:"")},c.updateProfile=function(){var b=f.open({size:"md",templateUrl:"views/modals/update_profile.html",controller:"ktUpdateProfileCtrl"});b.result.then(function(b){h.success("信息修改成功"),$.extend(a.user,b)})},c.updateBusinessCard=function(){function b(){j["delete"](function(){var b=f.open({size:"md",templateUrl:"views/modals/update_business_card.html",controller:"ktUpdateBusinessCardCtrl"});b.result.then(function(b){$.extend(a.user,b)})})}"passed"===a.user.status?h.swal({title:"",text:"上传名片后需重新审核，审核通过后才有权查看所有页面，确定上传？",type:"warning",showCancelButton:!0},function(a){a&&b()}):"rejected"===a.user.status&&b()},c.updateUserStatus=function(){h.swal({title:"您确定重新提交审核吗？",text:"提交审核后，审核结果会在1个工作日内以邮件的形式通知您。",showCancelButton:!0,showLoaderOnConfirm:!0},function(b){b&&j.update({content:"confirm"},function(){c.pendingRequests=!1,a.user.status="pended"},function(a){c.pendingRequests=!1,h.swal({title:"提交失败",text:$.isArray(a.error)?a.error.join("<br/>"):a.error||"抱歉，您的信息没有提交成功，请再次尝试！",type:"error"})})})},c.updatePassword=function(){var a=f.open({size:"md",templateUrl:"views/modals/update_password.html",controller:"ktUpdatePasswordCtrl"});a.result.then(function(){h.success("新密码修改成功！")})},c.updateMobile=function(){var b=f.open({size:"md",templateUrl:"views/modals/input_phone_captcha.html",controller:"ktPreUpdateMobileCtrl"});b.result.then(function(){var b=f.open({size:"md",templateUrl:"views/modals/input_phone_captcha.html",controller:"ktUpdateMobileCtrl"});b.result.then(function(b){h.success("手机修改成功！"),a.user.mobile=b.mobile})})},c.autoCopyDisabled=g.isSafari()||g.isSogou(),c.copyTooltip="按"+(g.isWindows()?"Ctrl":"⌘")+"-C复制!",c.copySuccess=function(){c.tooltipIsOpen=!0,b(function(){c.tooltipIsOpen=!1},1e3)},c.sendInviteCode=function(){i.get({content:"inviter_code"},function(){h.success("发送成功，请注意查看您的手机。")},function(a){h.error(a.error||"抱歉，系统繁忙。")})}}]).controller("ktUpdateProfileCtrl",["$rootScope","$scope","$uibModalInstance","ktAccountService",function(a,b,c,d){b.title="修改用户信息",b.user=$.extend(!0,{},a.user),b.user.content="update",b.submitForm=function(){d.update(b.user,function(){c.close(b.user)},function(a){b.error=a.error||"更新出错！"})},b.cancel=function(a){a.preventDefault(),c.dismiss("cancel")}}]).controller("ktUpdateBusinessCardCtrl",["$rootScope","$scope","$uibModalInstance","ktSweetAlert",function(a,b,c,d){b.title="上传名片",b.user=$.extend(!0,{},a.user),b.user.card_url=null,b.user.content="update_business_card",b.submitForm=function(){d.success("信息修改成功"),c.close(b.user)},b.close=function(e,f){e.preventDefault(),f&&(d.success("信息修改成功"),a.user.card_url=b.user.card_url,a.user.status=b.user.status),c.dismiss("cancel")}}]).controller("ktPreUpdateMobileCtrl",["$rootScope","$scope","$uibModalInstance","ktAccountService","ktGetCaptcha","ktCaptchaService","ktSweetAlert",function(a,b,c,d,e,f,g){b.title="原手机号验证",b.user=$.extend(!0,{},a.user),b.user.content="validate_prev_captcha",b.user.captcha="",b.hideMobileInput=!0,b.notLastStep=!0,b.imgCaptcha={},b.refreshImgCaptcha=function(){f.get(function(a){b.imgCaptcha.url=a.url,b.imgCaptcha.img_captcha_key=a.key})},b.refreshImgCaptcha();var h=e.initCaptcha(b,d,{content:"prev_captcha"},b.user);b.getCaptcha=function(a,c){return a.preventDefault(),a.stopPropagation(),"sms"===c&&b.waitCaptchaMessage||"tel"===c&&b.waitCaptchaTel?void 0:b.popForm.mobile.$invalid?(g.error("手机号号码不正确！"),void b.popForm.mobile.$setDirty()):b.popForm.img_captcha.$invalid?(g.error("请正确填写图形验证码！"),void b.popForm.img_captcha.$setDirty()):void h({mobile:b.user.mobile,img_captcha:b.user.img_captcha,img_captcha_key:b.imgCaptcha.img_captcha_key,channel:c})},b.submitForm=function(){d.update(b.user,function(){c.close(b.user)},function(a){b.error=a.error||"更新出错！"})},b.cancel=function(a){a.preventDefault(),c.dismiss("cancel")}}]).controller("ktUpdateMobileCtrl",["$rootScope","$scope","$uibModalInstance","ktAccountService","ktGetCaptcha","ktCaptchaService","ktSweetAlert",function(a,b,c,d,e,f,g){b.title="新手机号绑定",b.user=$.extend(!0,{},a.user),b.user={content:"mobile"},b.imgCaptcha={},b.refreshImgCaptcha=function(){f.get(function(a){b.imgCaptcha.url=a.url,b.imgCaptcha.img_captcha_key=a.key})},b.refreshImgCaptcha();var h=e.initCaptcha(b,d,{content:"captcha"},b.user);b.getCaptcha=function(a,c){return a.preventDefault(),a.stopPropagation(),"sms"===c&&b.waitCaptchaMessage||"tel"===c&&b.waitCaptchaTel?void 0:b.popForm.mobile.$invalid?(g.error("手机号号码不正确！"),void b.popForm.mobile.$setDirty()):b.popForm.img_captcha.$invalid?(g.error("请正确填写图形验证码！"),void b.popForm.img_captcha.$setDirty()):void h({mobile:b.user.mobile,img_captcha:b.user.img_captcha,img_captcha_key:b.imgCaptcha.img_captcha_key,channel:c})},b.submitForm=function(){d.update(b.user,function(){c.close(b.user),a.user.mobile=b.user.mobile},function(a){b.error=a.error||"更新出错！"})},b.cancel=function(a){a.preventDefault(),c.dismiss("cancel")}}]).controller("ktUpdatePasswordCtrl",["$rootScope","$scope","$uibModalInstance","ktAccountService",function(a,b,c,d){b.title="修改密码",b.user=$.extend(!0,{},a.user),b.user.content="password",b.submitForm=function(){d.update(b.user,function(){c.close(b.user)},function(a){b.error=a.error||"更新出错！"})},b.cancel=function(a){a.preventDefault(),c.dismiss("cancel")}}])}();