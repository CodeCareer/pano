!function(){"use strict";angular.module("kt.pano").controller("ktOverviewCtrl",["$scope","$window","$stateParams","ktDataHelper","ktOverviewService","ktValueFactory","ktEchartTheme1",function(a,b,c,d,e,f,g){a.updateDate=moment().subtract(7,"d").format("YYYY-MM-DD")+" ~ "+moment().subtract(1,"d").format("YYYY-MM-DD");var h=g.color,i=a.rateAmountChart={chartOptions:{},yAxis:"amount",yAxisFormat:"rmb",xAxis:"rate",xAxisFormat:"percent2",color:["#dd4444"],list:[]},j=a.durationRateChart={chartOptions:{},yAxis:"rate",yAxisFormat:"percent2",xAxis:"_id",color:["#6596e0","#ffa500"],xAxisFormat:null,list:[]},k=a.durationAmountChart={chartOptions:{},yAxis:"amount",yAxisFormat:"rmb",xAxis:"_id",xAxisFormat:null,list:[]},l=a.platformAssetTypeChart={chartOptions:{},yAxis:"amount",yAxisFormat:"percent2",xAxis:"_id",xAxisFormat:null,list:[]},m={yAxis:{axisLine:{show:!1,lineStyle:{width:1,color:"#afb7d0"}},splitLine:{show:!0,lineStyle:{color:["#f3f3f3"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},grid:{right:60},tooltip:{valueType:"rmb"}};i.updateDataView=function(){function b(){var a=c.data,b=_.map(a,function(a){return a[2]}),e=d.chartOptions("#rateAmountChart",b),g=_.map(a,function(a){return a[0]}),h=_.map(a,function(a){return a[1]});c.chartOptions=$.extend(!0,{},m,e,{legend:{data:b},tooltip:{axisPointer:{axis:"auto",type:"line"},trigger:"item",triggerOn:"mousemove",formatter:function(a){var b='<div class="f1_2rem chart-tooltip-title" style="border-bottom: 1px solid rgba(255,255,255,.3);padding-bottom: 5px;margin-bottom:5px;">'+a.value[2]+'</div><table class="f1_2rem chart-tooltip-table"><tr><td class="justify">加权收益率：</td><td>'+f(a.value[0],c.xAxisFormat)+'</td></tr><tr><td class="justify">发行量：</td><td>'+f(a.value[1],c.yAxisFormat)+"</td></tr>";return b},xAxisFormat:c.xAxisFormat,yAxisFormat:c.yAxisFormat},visualMap:[{show:!1,dimension:1,min:_.min(h),max:_.max(h),precision:1,inRange:{symbolSize:[10,50]},outOfRange:{symbolSize:[10,50],color:["rgba(0,0,0,.2)"]}}],yAxis:{name:"发行量（单位：万元）",boundaryGap:!0,type:"log"},xAxis:{max:function(){var a=_.max(g),b=_.round(a-(0|a),2);return _.ceil(a)+1*(b>.8)}(),min:function(){var a=_.min(g),b=_.round(a-(0|a),2);return _.floor(a)-1*(.3>b)}(),type:"value",name:"收益率",nameLocation:"end",nameGap:10,boundaryGap:!1},series:_.map(a,function(a){return{name:a[2],showEffectOn:"emphasis",itemStyle:{normal:{opacity:.7}},type:"effectScatter",rippleEffect:{period:8,scale:1.5,brushType:"fill"},data:[a]}})})}var c=this;e.get({chart:"summary"},function(d){c.data=d.stat,c.data.crawled_at&&(a.updateDate=moment(c.data.crawled_at).subtract(7,"d").format("YYYY-MM-DD")+" ~ "+moment().subtract(1,"d").format("YYYY-MM-DD")),b()})},j.updateDataView=function(){function a(){var a=b.data,c=_.map(a.data,"name"),e=d.chartOptions("#durationRateChart",c),f=b.color;b.chartOptions=$.extend(!0,{},m,e,{legend:{data:c},tooltip:{axisPointer:{axis:"auto",type:"line"},color:f,xAxisFormat:b.xAxisFormat,titlePrefix:"产品期限：",yAxisFormat:b.yAxisFormat},yAxis:{name:"收益率（单位：%）",interval:1,max:d.getAxisMax(a.data),min:0},xAxis:{type:"category",boundaryGap:!0,name:"期限",nameLocation:"end",nameGap:10,data:d.chartAxisFormat(a.xAxis,"MY")},series:_.map(a.data,function(a,b){return{name:a.name,type:"line",lineStyle:{normal:{color:f[b]}},itemStyle:{normal:{color:f[b]}},markLine:{data:d.getMarkLineCoords(a.data)},smooth:!1,data:a.data}})})}var b=this;e.get({chart:"rate"},function(c){b.data=d.chartDataPrune(c.stat),a()})},k.updateDataView=function(){function a(){var a=b.data,c=_.map(a.data,"name"),e=d.chartOptions("#durationAmountChart",c);b.chartOptions=$.extend(!0,{},m,e,{legend:{data:c},tooltip:{titlePrefix:"产品期限：",xAxisFormat:b.xAxisFormat,yAxisFormat:b.yAxisFormat},yAxis:{name:"发行量（单位：万元）"},xAxis:{type:"category",boundaryGap:!0,name:"期限",nameLocation:"end",nameGap:10,data:d.chartAxisFormat(a.xAxis,"MY")},series:_.map(a.data,function(a){return{name:a.name,type:"bar",barMaxWidth:40,data:a.data}})})}var b=this;e.get({chart:"circulation"},function(c){b.data=d.chartDataPrune(c.stat),a()})},l.updateDataView=function(){function a(){var a=c.data,e=_.map(a.data,"name"),f=d.chartOptions("#platformAssetTypeChart",e);c.chartOptions=$.extend(!0,{},m,f,{color:_.reverse(h.slice(0,e.length)),legend:{data:e},tooltip:{reverse:!0,xAxisFormat:c.xAxisFormat,yAxisFormat:c.yAxisFormat},yAxis:{name:"类型占比（单位：%）",max:100,min:0},xAxis:{type:"category",name:"平台",nameLocation:"end",nameGap:10,axisLabel:{interval:b.innerWidth>1e3?0:"auto"},boundaryGap:!0,data:a.xAxis},series:_.map(_.reverse(a.data),function(a){return{name:a.name,type:"bar",stack:"类型占比",barMaxWidth:40,data:a.data}})})}var c=this;e.get({chart:"circulation_pct"},function(b){c.data=d.chartDataToPercent(b.stat),a()})},i.updateDataView(),j.updateDataView(),k.updateDataView(),l.updateDataView()}])}();