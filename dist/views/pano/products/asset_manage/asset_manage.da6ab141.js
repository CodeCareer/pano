!function(){"use strict";angular.module("kt.pano").controller("ktAssetManageCtrl",["$scope","$location","$timeout","$stateParams","$rootScope","ktProductsService","ktProductTrendsService","ktDataHelper","ktSweetAlert",function(a,b,c,d,e,f,g,h,i){a.$on("$stateChangeSuccess",function(){c(function(){$("body").scrollTop(0)},100)});var j=b.search(),k=a.params=$.extend({},j);f.get({content:d.id},function(b){function d(b){_.isArray(b)&&(b.length%3!=0?(b.push({empty:!0}),d(b)):a.partitions=b)}function e(b){b.length%3!=0?(b.push({empty:!0}),e(b)):a.similars=b}a.productManage=b.products;var f=a.inst=b.from_info;f&&c(function(){f.descObj=h.textEllipsis(f.from_introduce,".init-main-info .desc",0,14,4,6)},100),a.similars=b.similar_products,d(b.products.partitions||[]),e(b.similar_products),k.begin_date=moment(Math.max(moment(b.products.begin_date).toDate(),moment(b.products.last_date).subtract(30,"days").toDate())).format("YYYY-MM-DD"),k.end_date=moment(b.products.last_date).format("YYYY-MM-DD"),a.datePicker=k.begin_date+"~"+k.end_date,a.$watch("datePicker",function(a,b){if(a!==b){var c=a.split("~"),d={begin_date:c[0],end_date:c[1]};l.updateDataView(d)}}),l.updateDataView();var g=a.durationRateChart={chartOptions:{},_params:{},yAxisFormat:"percent2",yAxis:"rate",xAxisFormat:null,list:[]};a.durationRateChart.chartOptions=$.extend(!0,{},r,{legend:{data:["各期限收益率"]},tooltip:{axisPointer:{axis:"auto",type:"line"},xAxisFormat:g.xAxisFormat,yAxisFormat:g.yAxisFormat},yAxis:{name:"收益率（%）"},xAxis:{type:"category",boundaryGap:!0,data:_.map(b.products.partitions,"life")},series:[{name:"各期限收益率",itemStyle:{normal:{opacity:.8},emphasis:{barBorderWidth:1,barBorderColor:"rgba(0,0,0,.5)"}},type:"line",step:"end",smooth:!1,data:_.map(b.products.partitions,"rate")}]})});var l=a.productRateTrend={chartOptions:{},_params:{},yAxisFormat:"percent2",yAxis:"rate",xAxisFormat:null,list:[]},m=15,n=65,o=50,p=80,q={text:"努力加载中...",color:"#3d4351",textColor:"#3d4351"},r={tooltip:{valueType:"rmb"},toolbox:{show:!1},legend:{left:"center",right:m/2,textStyle:{fontSize:12,color:"#626472"}},yAxis:{nameGap:20,splitLine:{show:!0,lineStyle:{color:["#f3f3f3"],width:1,type:"solid"}}},grid:{show:!0,top:o,left:n,right:m,bottom:p}};a.datepickerSettings={applyBtnClass:"btn btn-navy-blue btn-xs",singleMonth:!1,extraClass:"date-picker-pano-top",showWeekNumbers:!1,autoClose:!1,beforeShowDay:function(a){var b=moment(),c=a<=b.toDate()&&a>=moment("2016-03-01").toDate();return[c,"",c?"":"不在可选范围内"]}},l.updateDataView=function(a){function b(){var a=c.echart=echarts.getInstanceByDom($("#productRateTrend")[0]);c.chartOptions=$.extend(!0,{},r,{legend:{data:["收益率趋势"]},tooltip:{axisPointer:{axis:"auto",type:"line"},xAxisFormat:c.xAxisFormat,yAxisFormat:c.yAxisFormat},yAxis:{name:"收益率（%）"},xAxis:{type:"category",boundaryGap:!0,data:_.map(c.data,"date")},series:[{name:"收益率趋势",itemStyle:{normal:{opacity:.8},emphasis:{barBorderWidth:1,barBorderColor:"rgba(0,0,0,.5)"}},markLine:{data:h.getMarkLineCoords(_.map(c.data,"rate"))},smooth:!1,type:"line",data:_.map(c.data,"rate")}]}),a&&a.hideLoading()}var c=this;$.extend(c._params,a||{}),c.echart=echarts.getInstanceByDom($("#productRateTrend")[0]),c.echart&&(c.echart.hideLoading(),c.echart.showLoading(q)),g.get(h.cutDirtyParams($.extend(!0,{},k,{id:d.id},c._params)),function(a){c.data=a.rates,b()})},a.alertCode=function(){i.swal({title:'<h3 class="title-code">全部数据</h3><span class="alert-text">如想获得更多数据，请联系PANO微信小助手</span>',text:'<span class="img-pano"><img src="images/pano_wxSEC.0e2a6fbe.png"></span>',html:!0,showCloseButton:!0})}}])}();