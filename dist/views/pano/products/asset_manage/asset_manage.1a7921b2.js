!function(){"use strict";angular.module("kt.pano").controller("ktAssetManageCtrl",["$scope","$location","$stateParams","$rootScope","ktProductsService","ktProductTrendsService","ktDataHelper","ktSweetAlert",function(a,b,c,d,e,f,g,h){var i=b.search(),j=a.params=$.extend({},i);e.get({content:c.id},function(b){function c(b){b.length%3!==0?(b.push({empty:!0}),c(b)):a.termRates=b}function d(b){b.length%3!==0?(b.push({empty:!0}),d(b)):a.similars=b}a.productManage=b.products;var e=a.inst=b.from_info;e.descObj=g.textEllipsis(e.from_introduce,".init-main-info .desc",0,14,4,6),a.similars=b.similar_products,c(b.products.term_rates),d(b.similar_products),j.begin_date=moment(Math.max(moment(b.products.begin_date).toDate(),moment(b.products.last_date).subtract(30,"days").toDate())).format("YYYY-MM-DD"),j.end_date=moment(b.products.last_date).format("YYYY-MM-DD"),a.datePicker=j.begin_date+"~"+j.end_date,a.$watch("datePicker",function(a,b){if(a!==b){var c=a.split("~"),d={begin_date:c[0],end_date:c[1]};k.updateDataView(d)}}),k.updateDataView();var f=a.durationRateChart={chartOptions:{},_params:{},yAxisFormat:"percent2",yAxis:"rate",xAxisFormat:null,list:[]};a.durationRateChart.chartOptions=$.extend(!0,{},q,{legend:{data:["各期限收益率"]},tooltip:{axisPointer:{axis:"auto",type:"line"},xAxisFormat:f.xAxisFormat,yAxisFormat:f.yAxisFormat},yAxis:{name:"收益率（%）"},xAxis:{type:"category",boundaryGap:!0,data:_.map(b.products.term_rates,"life")},series:[{name:"各期限收益率",itemStyle:{normal:{opacity:.8},emphasis:{barBorderWidth:1,barBorderColor:"rgba(0,0,0,.5)"}},type:"line",step:"end",smooth:!1,data:_.map(b.products.term_rates,"rate")}]})});var k=a.productRateTrend={chartOptions:{},_params:{},yAxisFormat:"percent2",yAxis:"rate",xAxisFormat:null,list:[]},l=15,m=65,n=50,o=80,p={text:"努力加载中...",color:"#3d4351",textColor:"#3d4351"},q={tooltip:{valueType:"rmb"},toolbox:{show:!1},legend:{left:"center",right:l/2,textStyle:{fontSize:12,color:"#626472"}},yAxis:{nameGap:20,splitLine:{show:!0,lineStyle:{color:["#f3f3f3"],width:1,type:"solid"}}},grid:{show:!0,top:n,left:m,right:l,bottom:o}};a.datepickerSettings={applyBtnClass:"btn btn-navy-blue btn-xs",singleMonth:!1,extraClass:"date-picker-pano-top",showWeekNumbers:!1,autoClose:!1,beforeShowDay:function(a){var b=moment(),c=a<=b.toDate()&&a>=moment("2016-03-01").toDate(),d="",e=c?"":"不在可选范围内";return[c,d,e]}},k.updateDataView=function(a){function b(){var a=d.echart=echarts.getInstanceByDom($("#productRateTrend")[0]);d.chartOptions=$.extend(!0,{},q,{legend:{data:["收益率趋势"]},tooltip:{axisPointer:{axis:"auto",type:"line"},xAxisFormat:d.xAxisFormat,yAxisFormat:d.yAxisFormat},yAxis:{name:"收益率（%）"},xAxis:{type:"category",boundaryGap:!0,data:_.map(d.data,"date")},series:[{name:"收益率趋势",itemStyle:{normal:{opacity:.8},emphasis:{barBorderWidth:1,barBorderColor:"rgba(0,0,0,.5)"}},smooth:!1,type:"line",data:_.map(d.data,"rate")}]}),a&&a.hideLoading()}var d=this;$.extend(d._params,a||{}),d.echart=echarts.getInstanceByDom($("#productRateTrend")[0]),d.echart&&(d.echart.hideLoading(),d.echart.showLoading(p)),f.get(g.cutDirtyParams($.extend(!0,{},j,{id:c.id},d._params)),function(a){d.data=a.rates,b()})},a.alertCode=function(){h.swal({title:'<p class="alert">更多产品数据，请联系微信客服PANO酱</p>',text:'<div class="img-pano"><img src="images/pano_wxSEC.0e2a6fbe.png"></div>',html:!0,showCloseButton:!0})}}])}();