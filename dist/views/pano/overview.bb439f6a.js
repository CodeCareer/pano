!function(){"use strict";angular.module("kt.pano").controller("ktOverviewCtrl",["$scope","$state","$window","$stateParams","ktDataHelper","ktAnalyticsService","ktValueFactory","ktEchartTheme1",function(a,b,c,d,e,f,g,h){a.updateDate="获取中...";var i=h.color,j={yAxis:{axisLine:{show:!1,lineStyle:{width:1,color:"#afb7d0"}},splitLine:{show:!0,lineStyle:{color:["#f3f3f3"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},grid:{right:60},tooltip:{valueType:"rmb"}},k=a.rateAmountChart={chartOptions:{},yAxis:"amount",yAxisFormat:"rmb",xAxis:"rate",xAxisFormat:"percent2",color:["#dd4444"],list:[]};k.updateDataView=function(){function c(){var a=d.data,c=_.map(a,function(a){return a[2]}),f=e.chartOptions("#rateAmountChart",c),h=_.map(a,function(a){return a[0]}),i=_.map(a,function(a){return a[1]});d.chartOptions=$.extend(!0,{},j,f,{onclick:function(a){var c=b.href("pano.institutions.detail",{id:a.seriesName});window.open(c,"_blank")},legend:{data:c},tooltip:{axisPointer:{axis:"auto",type:"line"},trigger:"item",triggerOn:"mousemove",formatter:function(a){var b='<div class="f1_2rem chart-tooltip-title" style="border-bottom: 1px solid rgba(255,255,255,.3);padding-bottom: 5px;margin-bottom:5px;">'+a.value[2]+'</div><table class="f1_2rem chart-tooltip-table"><tr><td class="justify">加权收益率：</td><td>'+g(a.value[0],d.xAxisFormat)+'</td></tr><tr><td class="justify">发行量：</td><td>'+g(a.value[1],d.yAxisFormat)+"</td></tr>";return b},xAxisFormat:d.xAxisFormat,yAxisFormat:d.yAxisFormat},visualMap:[{show:!1,dimension:1,min:_.min(i),max:_.max(i),precision:1,inRange:{symbolSize:[10,50]},outOfRange:{symbolSize:[10,50],color:["rgba(0,0,0,.2)"]}}],yAxis:{name:"发行量（万元）",boundaryGap:!0,type:"log"},xAxis:{max:function(){var a=_.max(h),b=_.round(a-(0|a),2);return _.ceil(a)+1*(b>.8)}(),min:function(){var a=_.min(h),b=_.round(a-(0|a),2);return _.floor(a)-1*(.3>b)}(),type:"value",name:"收益率",nameLocation:"end",nameGap:10,boundaryGap:!1},series:_.map(a,function(a){return{name:a[2],showEffectOn:"emphasis",itemStyle:{normal:{opacity:.7}},type:"effectScatter",rippleEffect:{period:8,scale:1.5,brushType:"fill"},data:[a]}})})}var d=this;f.get({content:"overview",chart:"summary"},function(b){d.data=b.stat,b.crawled_at&&(a.updateDate=moment(b.crawled_at).subtract(6,"d").format("YYYY-MM-DD")+" ~ "+moment(b.crawled_at).format("YYYY-MM-DD")),c()})};var l=a.durationRateChart={chartOptions:{},yAxis:"rate",yAxisFormat:"percent2",xAxis:"_id",color:["#6596e0","#ffa500"],xAxisFormat:null,list:[]};l.updateDataView=function(){function a(){var a=b.data,c=_.map(a.data,"name"),d=e.chartOptions("#durationRateChart",c);b.chartOptions=$.extend(!0,{},j,d,{legend:{data:c},tooltip:{axisPointer:{axis:"auto",type:"line"},xAxisFormat:b.xAxisFormat,titlePrefix:"产品期限：",yAxisFormat:b.yAxisFormat},yAxis:{name:"收益率（%）",interval:1,max:e.getAxisMax(a.data),min:0},xAxis:{type:"category",boundaryGap:!0,name:"期限",nameLocation:"end",nameGap:10,data:e.chartAxisFormat(a.xAxis,"MY")},series:_.map(a.data,function(a){return{name:a.name,type:"line",markLine:{data:e.getMarkLineCoords(a.data)},smooth:!1,data:a.data}})})}var b=this;f.get({content:"overview",chart:"rate"},function(c){b.data=e.chartDataPrune(c.stat),a()})};var m=a.durationAmountChart={chartOptions:{},yAxis:"amount",yAxisFormat:"rmb",xAxis:"_id",xAxisFormat:null,list:[]};m.updateDataView=function(){function a(){var a=b.data,c=_.map(a.data,"name"),d=e.chartOptions("#durationAmountChart",c);b.chartOptions=$.extend(!0,{},j,d,{legend:{data:c},tooltip:{titlePrefix:"产品期限：",xAxisFormat:b.xAxisFormat,yAxisFormat:b.yAxisFormat},yAxis:{name:"发行量（万元）"},xAxis:{type:"category",boundaryGap:!0,name:"期限",nameLocation:"end",nameGap:10,data:e.chartAxisFormat(a.xAxis,"MY")},series:_.map(a.data,function(a){return{name:a.name,type:"bar",itemStyle:{normal:{opacity:.8}},barMaxWidth:40,data:a.data}})})}var b=this;f.get({content:"overview",chart:"circulation"},function(c){b.data=e.chartDataPrune(c.stat),a()})};var n=a.platformAssetTypeChart={chartOptions:{},yAxis:"amount",yAxisFormat:"percent2",xAxis:"_id",color:e.getDimentionSpecialColor("asset_type"),xAxisFormat:null,list:[]};n.updateDataView=function(){function a(){var a=b.data,d=_.map(a.data,"name"),f=e.chartOptions("#platformAssetTypeChart",d),g=b.color||i.slice(0,d.length);b.chartOptions=$.extend(!0,{},j,f,{color:_.reverse(g.slice(0)),legend:{data:d},tooltip:{reverse:!0,xAxisFormat:b.xAxisFormat,yAxisFormat:b.yAxisFormat},yAxis:{name:"类型占比（%）",max:100,min:0},xAxis:{type:"category",name:"平台",nameLocation:"end",nameGap:10,axisLabel:{interval:c.innerWidth>1e3?0:"auto"},boundaryGap:!0,data:a.xAxis},series:_.map(_.reverse(a.data),function(a){return{name:a.name,type:"bar",itemStyle:{normal:{opacity:.8}},stack:"类型占比",barMaxWidth:40,data:a.data}})})}var b=this;f.get({content:"overview",chart:"circulation_pct"},function(c){b.data=e.chartDataToPercent(c.stat),a()})},k.updateDataView(),l.updateDataView(),m.updateDataView(),n.updateDataView()}])}();