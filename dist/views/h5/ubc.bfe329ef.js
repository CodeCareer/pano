!function(a,b){function c(){var a=navigator.userAgent.toLowerCase();return!!a.match(/Android.*MicroMessenger/i)}b.addEventListener("DOMContentLoaded",function(){c()&&b.querySelector("html").classList.add("weixin");var a=location.href.match(/_t=(.*)/),d=a?a[1]:"",e="",f=b.querySelector(".container"),g=b.querySelector(".business-card-preview img"),h=b.querySelector("#file"),i=b.forms.namedItem("uploadBusinessCardForm"),j=b.querySelector("#doneBtn"),k=b.querySelector("#reUploadBtn"),l=new XMLHttpRequest;j.addEventListener("click",function(a){a.preventDefault();var b=new FormData(i);b.append("token",d),l.open("POST","/api/v1/cards",!0),l.onload=function(a){var b=JSON.parse(a.currentTarget.responseText);201===l.status&&(e=b.card_url,g.src=e,f.classList.remove("preview"),f.classList.add("done"),this.disabled=!1)},this.disabled=!0,this.innerHTML='上传中<i class="dotting"></i>',this.classList.add("pending"),l.send(b)}),k.addEventListener("click",function(a){a.preventDefault(),e="",f.classList.remove("preview"),j.disabled=!1,j.innerHTML="完成",l.abort(),i.reset()}),h.addEventListener("change",function(a){var b=new FileReader;b.addEventListener("load",function(){g.src=b.result,h.disabled=!1,f.classList.remove("preparing"),f.classList.add("preview")}),h.files[0]&&(h.disabled=!0,f.classList.add("preparing"),setTimeout(function(){b.readAsDataURL(h.files[0])},50)),a.preventDefault()})})}(window,document);