!function(){"use strict";function a(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c={selector:"#captcha",text:null,randomText:!0,randomColours:!0,width:300,height:200,colour1:"#eef7fb",colour2:"#4a6920",font:'bold 48px "Comic Sans MS", cursive, sans-serif',onSuccess:function(){alert("Correct!")},onError:function(){alert("Error")}},d=function(a){var b=this;this._settings=$.extend({},c,a||{}),this._container=$(this._settings.selector);var d=$("<div>").appendTo(this._container);this._canvas=$("<canvas>").appendTo(d).attr({height:this._settings.height,width:this._settings.width}).on("click",function(){b.generate()}),this._context=this._canvas.get(0).getContext("2d")};return d.prototype={generate:function(){var b=this,c=this._context;null!==this._settings.text&&""!==this._settings.text||(this._settings.randomText=!0),this._settings.randomText&&this._generateRandomText(),this._settings.randomColours&&(this._settings.colour1=this._generateRandomColour(180,255),this._settings.colour2=this._generateRandomColour(0,100)),c.clearRect(0,0,this._settings.width,this._settings.height),a(function(){c.fillStyle=b._settings.colour1,c.fillRect(0,0,b._settings.width,b._settings.height),c.fillStyle=b._settings.colour2,c.font=b._settings.font,c.setTransform(Math.random()/10+.9,.1-Math.random()/5,.1-Math.random()/5,Math.random()/10+.9,10,25),c.fillText(b._settings.text,0,0),c.setTransform(1,0,0,1,0,0);for(var a=Math.floor(1*Math.random()+5),d=0;a>d;d++)b._drawRandomCurve()},300*Math.random()+100)},validate:function(a,b){this._settings.text&&a&&a.toLowerCase()===this._settings.text.toLowerCase()?(this._settings.onSuccess(),this._settings.text="",b&&b(!0)):(this._settings.onError(),this.generate(),b&&b(!1))},_drawRandomCurve:function(){var a=this._context;a.strokeStyle=this._settings.colour2,a.lineWidth=Math.floor(1*Math.random()+1),a.beginPath(),a.moveTo(Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height)),a.bezierCurveTo(Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height),Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height),Math.floor(Math.random()*this._settings.width),Math.floor(Math.random()*this._settings.height)),a.stroke()},_generateRandomText:function(){this._settings.text="";for(var a=4,c=0;a>c;c++)this._settings.text+=b.charAt(Math.floor(Math.random()*b.length))},_generateRandomColour:function(a,b){return b=b||255,a=a||0,"rgb("+Math.floor(Math.random()*b+a)+", "+Math.floor(Math.random()*b+a)+", "+Math.floor(Math.random()*b+a)+")"}},d}function b(){return{timerMessage:function(a){return function(b){var c,d=0;a.timerMessage=b,c=setInterval(function(){a.timerMessage--,a.timerMessage<=0&&(a.waitCaptchaMessage=!1,clearInterval(c)),d++,d>10&&(a.messageTimerMoreThanTen=!0),a.$apply()},1e3)}},timerTel:function(a){return function(b){var c;a.timerTel=b,c=setInterval(function(){a.timerTel--,a.timerTel<=0&&(a.waitCaptchaTel=!1,clearInterval(c)),a.$apply()},1e3)}}}}a.$inject=["$timeout"],angular.module("kt.common").factory("ktCaptcha",a).factory("ktCaptchaHelper",b)}();