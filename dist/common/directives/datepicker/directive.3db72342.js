!function(){"use strict";angular.module("kt.common").directive("ktDatePicker",function(){return{restrict:"A",scope:{uibBtnRadio:"=",datepickerSettings:"="},require:"ngModel",link:function(a,b,c,d){function e(){return b.dateRangePicker(g).on("datepicker-apply",function(c,e){g.noUpdate||(a.uibBtnRadio&&(a.uibBtnRadio=e.value),d.$setViewValue(e.value,"done"),d.$render()),b.attr({title:e.value})}).on("datepicker-change",function(a,b){if("month"===g.batchMode||"month-range"===g.batchMode){var c=b.value.split("~"),d=moment(c[0]),e=moment(c[1]);$("."+f+" .start-month").text(d.format("YYYY年MM月")),$("."+f+" .end-month").text(e.format("YYYY年MM月")),$("."+f+" .selected-months-num").text(e.month()-d.month()+12*(e.year()-d.year())+1)}}).on("datepicker-first-date-selected",function(a,b){"month"!==g.batchMode&&"month-range"!==g.batchMode||$("."+f+" .start-month").text(moment(b.date1).format("YYYY年MM月"))}).on("datepicker-opened",function(){b.parent().addClass("opened")}).on("datepicker-closed",function(){b.parent().removeClass("opened")}).on("datepicker-first-date-selected",function(a,b){g.singleDate&&g.autoClose&&(d.$setViewValue(moment(b.date1).format("YYYY-MM-DD"),"done"),d.$render())}),g.triggerEvent&&setTimeout(function(){b.trigger(g.triggerEvent,{value:d.$viewValue})},100),b.data("dateRangePicker")}a.period=c.batchMode||"false",_.each(c,function(b,d){!_.isString(b)||"true"!==b&&"false"!==b||(c[d]=a.$eval(b))});var f=_.uniqueId("datepicker-"),g=$.extend({separator:"~",startOfWeek:"monday",showShortcuts:!0,applyBtnClass:"btn btn-default btn-xs"},a.datepickerSettings,c);"month"!==g.batchMode&&"month-range"!==g.batchMode||(g.customTopBar=function(){return'<div class="normal-top"><span style="color:#333">已选择: </span> <b class="start-month">...</b> <span class="separator-day"> ~ </span> <b class="end-month">...</b><i class="selected-days" style="display: inline;">(<span class="selected-months-num">...</span> 个月)</i></div><div class="error-top">error</div><div class="default-top">请选择一个日期范围</div>'}),g.extraClass&&(g.extraClass=g.extraClass+" "+f),g.shortcuts&&(g.shortcuts=a.$eval(g.shortcuts)),"span"===g.openType&&$.extend(g,{getValue:function(){return this.innerHTML},setValue:function(a){this.innerHTML=a}}),e()}}})}();