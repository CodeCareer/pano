!function(){"use strict";angular.module("kt.pano").directive("ktBusinessCard",["$rootScope","$timeout","ktBusinessCardUpload","ktCardsService","ktSweetAlert",function(a,b,c,d,e){return{restrict:"AE",scope:{ktSubmit:"&",close:"&dialogClose",uploadType:"@",user:"=ktUser"},templateUrl:"scripts/directives/business-card-upload/template.html",link:function(a){function f(){i=b(function(){d.get(function(b){b.user&&b.user.card_url&&(a.user.card_url=b.user.card_url),j||f()})},3500)}var g=a.ktSubmit,h=a.close;a.upload=function(b){b&&(a.pendingUpload=!0,c({file:b[0],token:a.user.id}).then(function(b){a.pendingUpload=!1,a.user.card_url=b.data.user.card_url},function(b){e.swal({title:"失败",text:b.error||"抱歉，服务器繁忙！",type:"error"}),a.pendingUpload=!1}))},a.deleteCardUrl=function(){a.user.card_url=null,d["delete"]()};var i,j=!1;f(),a.qrcode={},a.qrcode.settings={text:location.origin+"/views/h5/ubc.html?r="+Math.random().toString(16).slice(2,7)+"&t="+a.user.id,width:340,height:340,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H},a.submitForm=function(){return a.pendingRequests=!0,d.update({content:"confirm"},function(c){a.pendingRequests=!1,e.swal({title:"提交成功！",text:"",type:"success"},function(){j=!0,b.cancel(i),$.extend(a.user,c.account),g()})},function(b){a.pendingRequests=!1,e.swal({title:"提交失败",text:$.isArray(b.error)?b.error.join("<br/>"):b.error||"抱歉，您的信息没有提交成功，请再次尝试！",type:"error"})}),!1},a.closeDialog=function(a){b.cancel(i),j=!0,h(a)}}}}])}();